<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de Derecho Penal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --success: #059669;
      --danger: #dc2626;
      --ring: rgba(37, 99, 235, 0.25);
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    header.hero {
      text-align: center;
      margin-bottom: 16px;
    }
    .title {
      font-size: 32px;
      font-weight: 800;
      color: var(--primary-dark);
      margin: 0 0 8px;
    }
    .subtitle {
      color: var(--muted);
      margin: 0;
    }
    .controls {
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.06);
      padding: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: center;
      position: sticky;
      top: 12px;
      z-index: 5;
    }
    .controls label { font-weight: 500; }
    select {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #fff;
      outline: none;
      transition: box-shadow .2s, border-color .2s;
    }
    select:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); }

    .btn {
      cursor: pointer;
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-weight: 700;
      transition: transform .15s, background .2s, box-shadow .2s;
      color: #fff;
      background: var(--primary);
      box-shadow: 0 6px 14px rgba(37,99,235,.2);
    }
    .btn:hover { transform: translateY(-1px); background: var(--primary-dark); }
    .btn.secondary { background: #6b7280; }
    .btn.secondary:hover { background: #374151; }
    .btn.success { background: var(--success); }
    .btn.success:hover { background: #047857; }
    .btn.danger { background: var(--danger); }
    .btn.danger:hover { background: #b91c1c; }

    .progress {
      width: 100%;
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), #60a5fa);
      transition: width .3s ease;
    }

    .question {
      margin: 14px 0;
      padding: 18px;
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    .q-head {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    .q-num {
      font-weight: 800;
      color: var(--primary-dark);
    }
    .q-text { margin: 0; }

    .options { margin-top: 10px; display: grid; gap: 8px; }
    .option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #fff;
      transition: background .15s, border-color .15s, box-shadow .15s;
      cursor: pointer;
    }
    .option input { transform: scale(1.2); }
    .option:hover { background: #f9fafb; border-color: #d1d5db; }
    .option.is-selected { box-shadow: 0 0 0 4px var(--ring); border-color: var(--primary); }

    .justification {
      margin-top: 10px; color: var(--muted);
    }
    .correct { color: var(--success); font-weight: 700; }
    .incorrect { color: var(--danger); font-weight: 700; }

    .option.correct-option {
      border-color: rgba(5,150,105,.4);
      background: #ecfdf5;
    }
    .option.wrong-option {
      border-color: rgba(220,38,38,.4);
      background: #fef2f2;
    }

    .result-card {
      margin: 18px 0;
      padding: 16px;
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.06);
      text-align: center;
    }
    .score {
      font-size: 22px;
      font-weight: 800;
      margin: 8px 0;
    }
    .muted { color: var(--muted); }
    footer { text-align: center; margin-top: 24px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1 class="title">Test de Derecho Penal</h1>
      <p class="subtitle">Selecciona cuÃ¡ntas preguntas quieres y pulsa <strong>Comenzar</strong>.</p>
    </header>

    <div class="controls">
      <label for="numPreguntas">NÃºmero de preguntas:</label>
      <select id="numPreguntas">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50" selected>50</option>
      </select>
      <button class="btn" type="button" onclick="cargarTest()">Comenzar</button>
      <button class="btn secondary" type="button" onclick="reiniciarTest()">Reiniciar</button>
      <div class="progress" style="flex-basis: 100%;">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <form id="testForm"></form>

    <div id="testResult"></div>
    <footer>Â© Test de prÃ¡ctica â€” Derecho Penal</footer>
  </div>

<script>
// === BANCO DE PREGUNTAS ===
const preguntasBanco = [
  // ðŸ”¹ AquÃ­ deja tus preguntas (no borres ni modifiques su estructura actual)
  // Por ejemplo:
   {
  pregunta: "El artÃ­culo 14 de la ConstituciÃ³n EspaÃ±ola establece:",
  opciones: ["a) La igualdad de todos ante la ley sin discriminaciÃ³n.", "b) La obligaciÃ³n de los poderes pÃºblicos de remover obstÃ¡culos.", "c) La igualdad formal y material al mismo tiempo.", "d) Que la igualdad es solo un principio programÃ¡tico, no un derecho fundamental."],
  correcta: "a) La igualdad de todos ante la ley sin discriminaciÃ³n.",
  justificacion: "El artÃ­culo 14 CE recoge la igualdad ante la ley y la no discriminaciÃ³n como derecho fundamental."
},
{
  pregunta: "Selecciona la opciÃ³n incorrecta sobre la igualdad formal:",
  opciones: ["a) EstÃ¡ recogida en normas jurÃ­dicas.", "b) ProhÃ­be la discriminaciÃ³n legal explÃ­cita.", "c) Garantiza igualdad de trato en la aplicaciÃ³n de la ley.", "d) Supone polÃ­ticas pÃºblicas para corregir desigualdades reales."],
  correcta: "d) Supone polÃ­ticas pÃºblicas para corregir desigualdades reales.",
  justificacion: "La igualdad formal se refiere a la igualdad legal, no a la material. Las polÃ­ticas pÃºblicas son parte de la igualdad sustantiva (art. 9.2 CE)."
},
{
  pregunta: "La igualdad material o sustantiva se relaciona con:",
  opciones: ["a) El artÃ­culo 14 CE.", "b) El artÃ­culo 9.2 CE.", "c) La DeclaraciÃ³n de Derechos Humanos.", "d) El principio de legalidad."],
  correcta: "b) El artÃ­culo 9.2 CE.",
  justificacion: "El art. 9.2 CE obliga a los poderes pÃºblicos a promover condiciones para la igualdad real y efectiva."
},
  // ... (todas las demÃ¡s preguntas van aquÃ­)
];

// === FUNCIONES DE LÃ“GICA DEL TEST ===

// Mezcla los elementos de un array (algoritmo de Fisher-Yates)
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Carga el test con preguntas y respuestas aleatorias
function cargarTest() {
  const numPreguntas = parseInt(document.getElementById('numPreguntas').value);
  const testForm = document.getElementById('testForm');
  const progressBar = document.getElementById('progressBar');
  const testResult = document.getElementById('testResult');

  testForm.innerHTML = '';
  testResult.innerHTML = '';
  progressBar.style.width = '0%';

  // Mezclar las preguntas
  const preguntasSeleccionadas = shuffle([...preguntasBanco]).slice(0, numPreguntas);

  preguntasSeleccionadas.forEach((preguntaObj, index) => {
    // Mezclar opciones y actualizar la correcta
    const opcionesMezcladas = shuffle([...preguntaObj.opciones]);
    const correctaActualizada = opcionesMezcladas.find(opt => opt === preguntaObj.correcta);

    const preguntaHTML = `
      <div class="question" data-correcta="${correctaActualizada}">
        <div class="q-head">
          <span class="q-num">${index + 1}.</span>
          <p class="q-text">${preguntaObj.pregunta}</p>
        </div>
        <div class="options">
          ${opcionesMezcladas.map(opcion => `
            <label class="option">
              <input type="radio" name="pregunta${index}" value="${opcion}">
              ${opcion}
            </label>
          `).join('')}
        </div>
        <div class="justification muted" style="display:none;">
          <span class="correct">âœ” ${correctaActualizada}</span><br>
          ${preguntaObj.justificacion}
        </div>
      </div>
    `;
    testForm.insertAdjacentHTML('beforeend', preguntaHTML);
  });

  // Botonera inferior
  const actions = document.createElement('div');
  actions.style.textAlign = 'center';
  actions.style.marginTop = '14px';
  actions.innerHTML = '<button class="btn success" type="button" onclick="corregir()">âœ… Enviar</button>';
  testForm.appendChild(actions);

  // SelecciÃ³n visual on click
  testForm.querySelectorAll('.option input').forEach(inp => {
    inp.addEventListener('change', (e) => {
      const group = e.target.name;
      // Quitar selecciÃ³n previa
      testForm.querySelectorAll(`input[name="${group}"]`).forEach(i2 => {
        i2.closest('.option').classList.remove('is-selected');
      });
      e.target.closest('.option').classList.add('is-selected');

      // Progreso (contar cuÃ¡ntas preguntas ya tienen marcada una opciÃ³n)
      const respondidas = new Set();
      testForm.querySelectorAll('.option input:checked').forEach(i3 => respondidas.add(i3.name));
      setProgress(respondidas.size, totalPreguntasRenderizadas);
    });
  });
}

function corregir() {
  const preguntas = document.querySelectorAll('.question');
  let aciertos = 0;

  preguntas.forEach(q => {
    const seleccion = q.querySelector('input[type="radio"]:checked');
    const justDiv = q.querySelector('.justification');

    // Limpiar estilos previos
    q.querySelectorAll('.option').forEach(lbl => {
      lbl.classList.remove('correct-option', 'wrong-option');
    });

    // Marcar siempre la opciÃ³n correcta
    q.querySelectorAll('.option input').forEach(inp => {
      if (inp.value === inp.dataset.correcta) {
        inp.closest('.option').classList.add('correct-option');
      }
    });

    if (seleccion) {
      if (seleccion.value === seleccion.dataset.correcta) {
        aciertos++;
        justDiv.innerHTML = `<span class="correct">âœ” ${seleccion.dataset.justificacion}</span>`;
      } else {
        // SeÃ±alar la opciÃ³n elegida como errÃ³nea
        seleccion.closest('.option').classList.add('wrong-option');
        justDiv.innerHTML = `<span class="incorrect">âœ˜ ${seleccion.dataset.justificacion}</span>`;
      }
    } else {
      justDiv.innerHTML = `<span class="incorrect">âœ˜ No contestada</span>`;
    }
  });

  const result = document.getElementById('testResult');
  const total = preguntas.length;
  const pct = Math.round((aciertos / total) * 100);
  const emoji = pct >= 70 ? "ðŸŽ‰" : (pct >= 50 ? "ðŸ™‚" : "ðŸ’ª");
  result.innerHTML = `
    <div class="result-card">
      <div class="muted">Resultado</div>
      <div class="score">${emoji} ${aciertos} / ${total} (${pct}%)</div>
      <div class="muted">Puedes cambiar tus respuestas y volver a pulsar <strong>Enviar</strong>.</div>
    </div>
  `;
}

function reiniciarTest() {
  document.getElementById('testForm').innerHTML = '';
  document.getElementById('testResult').innerHTML = '';
  setProgress(0, 0);
}
  // ==========================
// ðŸ”¹ TEMPORIZADOR CONFIGURABLE
// ==========================

// Variables del temporizador
let tiempoTotal = 0;
let tiempoRestante = 0;
let temporizadorInterval;

// Crear selector de tiempo en el panel de controles
const selectTiempo = document.createElement('select');
selectTiempo.id = 'tiempoSeleccionado';
selectTiempo.innerHTML = `
  <option value="0">Sin lÃ­mite</option>
  <option value="5">5 minutos</option>
  <option value="10" selected>10 minutos</option>
  <option value="15">15 minutos</option>
  <option value="20">20 minutos</option>
  <option value="30">30 minutos</option>
  <option value="40">40 minutos</option>
  <option value="50">50 minutos</option>
  <option value="60">60 minutos</option>
`;
const labelTiempo = document.createElement('label');
labelTiempo.htmlFor = 'tiempoSeleccionado';
labelTiempo.textContent = 'Tiempo lÃ­mite:';
const controlsDiv = document.querySelector('.controls');
controlsDiv.insertBefore(labelTiempo, controlsDiv.children[2]);
controlsDiv.insertBefore(selectTiempo, controlsDiv.children[3]);

// Crear elemento visual del temporizador
const temporizadorDiv = document.createElement('div');
temporizadorDiv.id = 'temporizador';
temporizadorDiv.style.textAlign = 'center';
temporizadorDiv.style.fontSize = '18px';
temporizadorDiv.style.fontWeight = '700';
temporizadorDiv.style.color = '#2563eb';
temporizadorDiv.style.marginTop = '12px';
controlsDiv.appendChild(temporizadorDiv);

// Mostrar tiempo en formato mm:ss
function mostrarTiempo() {
  let min = Math.floor(tiempoRestante / 60);
  let seg = tiempoRestante % 60;
  temporizadorDiv.textContent = `â³ Tiempo restante: ${min}:${seg.toString().padStart(2, '0')}`;
}

// Iniciar temporizador
function iniciarTemporizador() {
  const minutosSeleccionados = parseInt(document.getElementById('tiempoSeleccionado').value);
  if (minutosSeleccionados === 0) {
    temporizadorDiv.textContent = 'â³ Sin lÃ­mite de tiempo';
    return;
  }

  tiempoTotal = minutosSeleccionados * 60;
  tiempoRestante = tiempoTotal;
  mostrarTiempo();

  temporizadorInterval = setInterval(() => {
    tiempoRestante--;
    mostrarTiempo();
    if (tiempoRestante <= 0) {
      clearInterval(temporizadorInterval);
      temporizadorDiv.textContent = 'â° Â¡Tiempo agotado!';
      finalizarTestPorTiempo();
    }
  }, 1000);
}

// Detener temporizador
function detenerTemporizador() {
  clearInterval(temporizadorInterval);
}

// Modificar funciÃ³n cargarTest para que inicie el temporizador
const originalCargarTest = cargarTest;
cargarTest = function() {
  originalCargarTest();
  detenerTemporizador(); // Por si se reinicia
  iniciarTemporizador();
};

// Al finalizar el test manualmente (botÃ³n Enviar)
const originalEvaluarTest = evaluarTest;
evaluarTest = function() {
  detenerTemporizador(); // Detiene el contador al pulsar Enviar
  originalEvaluarTest();
};

// Cuando el tiempo se agota automÃ¡ticamente
function finalizarTestPorTiempo() {
  // Evita ejecuciones dobles
  if (window.__finalizadoPorTiempo__) return;
  window.__finalizadoPorTiempo__ = true;

  detenerTemporizador();
  if (temporizadorDiv) temporizadorDiv.textContent = 'â° Â¡Tiempo agotado! Pulsa "Enviar" para corregir.';

  // ðŸ”’ Bloquear todas las respuestas
  document.querySelectorAll('input[type="radio"]').forEach(r => {
    r.disabled = true;
    const opt = r.closest('.option');
    if (opt) {
      opt.style.opacity = '0.6';
      opt.style.pointerEvents = 'none';
    }
  });

  // âœ… Dejar el botÃ³n "Enviar" activo y hacerlo destacar en verde
  const btnEnviar = document.querySelector('button.btn.success, button[type="submit"]');
  if (btnEnviar) {
    btnEnviar.disabled = false;
    btnEnviar.style.opacity = '1';
    btnEnviar.style.cursor = 'pointer';

    // ðŸ’š Efecto parpadeo verde suave
    btnEnviar.style.animation = 'blinkGreen 1.2s infinite';
    btnEnviar.style.transition = 'background-color 0.3s ease';
    btnEnviar.style.backgroundColor = '#22c55e'; // verde suave (Tailwind: green-500)
    btnEnviar.style.color = 'white';

    // Inyectar animaciÃ³n CSS si no existe
    if (!document.getElementById('blinkGreen-style')) {
      const style = document.createElement('style');
      style.id = 'blinkGreen-style';
      style.textContent = `
        @keyframes blinkGreen {
          0%, 100% { background-color: #22c55e; }
          50% { background-color: #86efac; } /* verde claro (green-300) */
        }
      `;
      document.head.appendChild(style);
    }
  }

  // ðŸ”„ Mantener botÃ³n "Reiniciar" activo
  const btnReiniciar = document.querySelector('button.btn.secondary');
  if (btnReiniciar) {
    btnReiniciar.disabled = false;
  }
}
</script>
</body>
</html>
